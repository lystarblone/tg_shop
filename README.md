# E-COMMERCE Telegram Bot

–≠—Ç–æ Telegram-–±–æ—Ç –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ä–∑–∏–Ω—ã, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏ –±–∞–∑–æ–≤–æ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏. –ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±–∞–∑–µ Aiogram 3.x, SQLAlchemy (PostgreSQL), Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- **–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤**:
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (/catalog).
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Ü–µ–Ω–∞–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º.
  - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω–∞; —Ñ–æ—Ç–æ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).
  - –ù–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.
- **–ö–æ—Ä–∑–∏–Ω–∞**:
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ (/cart, –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É").
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º–æ–π.
  - –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã (–∫–Ω–æ–ø–∫–∞ "–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É").
  - *–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ*: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.
- **–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞**:
  - –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å.
  - –í—ã–±–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏: –∫—É—Ä—å–µ—Ä –∏–ª–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑.
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º.
- **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ):
  - –ö–æ–º–∞–Ω–¥—ã: /addproduct, /editproduct, /setstatus.
  - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤.
- **–ö–æ–º–∞–Ω–¥—ã**:
  - /start ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
  - /catalog ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
  - /cart ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã.
  - /orders ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  - /addproduct, /editproduct, /setstatus ‚Äî –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.10+
- Aiogram 3.x (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram API)
- SQLAlchemy + AsyncPG (PostgreSQL)
- Redis (–∫–æ—Ä–∑–∏–Ω–∞)
- Pydantic v2 (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
- pytest, pytest-asyncio (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- Logging (–∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

1. **Handlers** (`app/handlers/`):
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram-—Å–æ–±—ã—Ç–∏–π (–∫–æ–º–∞–Ω–¥—ã, callback).
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç FSM (Finite State Machine) –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.
   - –ü—Ä–∏–º–µ—Ä—ã: `catalog.py` (–∫–∞—Ç–∞–ª–æ–≥), `cart.py` (–∫–æ—Ä–∑–∏–Ω–∞), `order.py` (–∑–∞–∫–∞–∑—ã).

2. **Services** (`app/services/`):
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: `CartService` (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π –≤ Redis), `user_service`, `product_service`, `order_service`.
   - –í—ã–ø–æ–ª–Ω—è—é—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—è —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏.

3. **Repositories** (`app/repositories/`):
   - CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î (PostgreSQL) —á–µ—Ä–µ–∑ SQLAlchemy.
   - –ü—Ä–∏–º–µ—Ä—ã: `user_repository`, `product_repository`, `order_repository`.

4. **Models** (`app/models/`):
   - SQLAlchemy-–º–æ–¥–µ–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü: User, Product, Category, Order, OrderItem.
   - –û–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î.

5. **Schemas** (`app/schemas/`):
   - Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (UserCreate, ProductCreate, OrderCreate).

6. **Core** (`app/core/`):
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (settings), –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ (main.py), –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis.

7. **Utils** (`app/utils/`):
   - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–ü–∞—Ç—Ç–µ—Ä–Ω—ã**:
- **Repository Pattern**: –æ—Ç–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.
- **Service Layer**: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.
- **FSM**: —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.

**–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**:
- **PostgreSQL**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ç–æ–≤–∞—Ä—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∑–∞–∫–∞–∑—ã.
- **Redis**: –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω (–∫–ª—é—á `cart:<user_id>`).

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
Users
‚îú‚îÄ‚îÄ id (PK, Integer)
‚îú‚îÄ‚îÄ telegram_id (Integer, unique)
‚îú‚îÄ‚îÄ username (String, nullable)
‚îú‚îÄ‚îÄ name (String, nullable)
‚îî‚îÄ‚îÄ is_admin (Boolean, default=False)

Categories
‚îú‚îÄ‚îÄ id (PK, Integer)
‚îú‚îÄ‚îÄ name (String, not null)
‚îî‚îÄ‚îÄ description (Text, nullable)

Products
‚îú‚îÄ‚îÄ id (PK, Integer)
‚îú‚îÄ‚îÄ sku (String, unique, not null)
‚îú‚îÄ‚îÄ name (String, not null)
‚îú‚îÄ‚îÄ description (Text, nullable)
‚îú‚îÄ‚îÄ price (Numeric(10,2), not null)
‚îú‚îÄ‚îÄ currency (String(3), default="USD")
‚îú‚îÄ‚îÄ quantity (Integer, default=0)
‚îú‚îÄ‚îÄ category_id (FK to Categories.id, nullable)
‚îú‚îÄ‚îÄ photo_url (Text, nullable)
‚îú‚îÄ‚îÄ created_at (DateTime)
‚îî‚îÄ‚îÄ updated_at (DateTime)

Orders
‚îú‚îÄ‚îÄ id (PK, Integer)
‚îú‚îÄ‚îÄ user_id (FK to Users.id, not null)
‚îú‚îÄ‚îÄ status (String(50), default="pending")
‚îú‚îÄ‚îÄ total_price (Float, not null)
‚îú‚îÄ‚îÄ delivery_address (String(255), nullable)
‚îú‚îÄ‚îÄ contact_phone (String(20), nullable)
‚îî‚îÄ‚îÄ created_at (DateTime)

OrderItems
‚îú‚îÄ‚îÄ id (PK, Integer)
‚îú‚îÄ‚îÄ order_id (FK to Orders.id, not null)
‚îú‚îÄ‚îÄ product_id (FK to Products.id, not null)
‚îú‚îÄ‚îÄ quantity (Integer, not null)
‚îî‚îÄ‚îÄ price (Float, not null)
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL:
   ```bash
   sudo apt update
   sudo apt install postgresql
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
   ```bash
   sudo -u postgres psql
   CREATE DATABASE ecommerce;
   CREATE USER user WITH PASSWORD 'password';
   GRANT ALL PRIVILEGES ON DATABASE ecommerce TO user;
   \q
   ```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Å DATABASE_URL:
   ```
   DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/ecommerce
   ```

4. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`init_models` –≤ `app/models/db.py`).

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
   ```bash
   git clone <repo-url>
   cd ecommerce-bot
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**:
   ```bash
   python -m venv venv
   source venv/bin/activate
   ```

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   ```bash
   pip install -r requirements.txt
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env**:
   –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
   ```
   BOT_TOKEN=your_telegram_bot_token
   DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/ecommerce
   REDIS_URL=redis://localhost:6379/0
   ADMIN_IDS=123456789,987654321
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Redis**:
   ```bash
   sudo apt install redis-server
   redis-server
   ```

6. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç**:
   ```bash
   python app/core/main.py
   ```

## –ó–∞–ø—É—Å–∫ —Å Docker

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
   ```bash
   docker --version
   docker-compose --version
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ `.env` (—Å–º. –≤—ã—à–µ).

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   docker-compose up -d --build
   ```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   docker-compose logs -f bot
   ```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥

1. **–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞**:
   - –ö–æ–º–∞–Ω–¥–∞: `/start`
   - –û—Ç–≤–µ—Ç:
     ```
     üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à E-COMMERCE –±–æ—Ç!
     –Ø –ø–æ–º–æ–≥—É –≤–∞–º —É–¥–æ–±–Ω–æ –ø–æ–∫—É–ø–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –ø—Ä—è–º–æ –∑–¥–µ—Å—å! –í—ã –º–æ–∂–µ—Ç–µ:
     üõç –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
     üõí –î–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
     üì¶ –û—Ñ–æ—Ä–º–ª—è—Ç—å –∑–∞–∫–∞–∑—ã –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö —Å—Ç–∞—Ç—É—Å
     –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –Ω–∞–∂–º–∏—Ç–µ /catalog
     ```

2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞**:
   - –ö–æ–º–∞–Ω–¥–∞: `/catalog`
   - –û—Ç–≤–µ—Ç: –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞", "–û–¥–µ–∂–¥–∞") —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏.

3. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã**:
   - –ö–æ–º–∞–Ω–¥–∞: `/cart`
   - –û—Ç–≤–µ—Ç:
     ```
     üì¶ –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞:
     –°–º–∞—Ä—Ç—Ñ–æ–Ω √ó 1 = 30000 ‚ÇΩ
     –ù–∞—É—à–Ω–∏–∫–∏ √ó 2 = 6000 ‚ÇΩ
     –ò—Ç–æ–≥–æ: 36000 ‚ÇΩ
     ```
     –ö–Ω–æ–ø–∫–∏: "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑", "–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É".

4. **–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞**:
   - –ù–∞–∂–º–∏—Ç–µ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" –≤ –∫–æ—Ä–∑–∏–Ω–µ.
   - –í–≤–µ–¥–∏—Ç–µ –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É.
   - –û—Ç–≤–µ—Ç:
     ```
     ‚úÖ –ó–∞–∫–∞–∑ #ORD-123456-ABC123 –æ—Ñ–æ—Ä–º–ª–µ–Ω!
     –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
     –¢–µ–ª–µ—Ñ–æ–Ω: +79991234567
     –ê–¥—Ä–µ—Å: –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, 10
     –î–æ—Å—Ç–∞–≤–∫–∞: –ö—É—Ä—å–µ—Ä
     –°—É–º–º–∞: 36000 ‚ÇΩ
     ```

5. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤**:
   - –ö–æ–º–∞–Ω–¥–∞: `/orders`
   - –û—Ç–≤–µ—Ç:
     ```
     üì¶ –í–∞—à–∏ –∑–∞–∫–∞–∑—ã:
     –ó–∞–∫–∞–∑ #1 - –°—Ç–∞—Ç—É—Å: pending - –°—É–º–º–∞: 36000 ‚ÇΩ
     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     –ó–∞–∫–∞–∑ #2 - –°—Ç–∞—Ç—É—Å: shipped - –°—É–º–º–∞: 15000 ‚ÇΩ
     ```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç unit-—Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. –¢–µ—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `tests/`.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```bash
pip install pytest pytest-asyncio fakeredis
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
pytest tests/ -v
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ (`tests/test_cart_service.py`)

```python
import pytest
from app.services.cart_service import CartService
from unittest.mock import AsyncMock, patch
import fakeredis.aioredis

@pytest.mark.asyncio
async def test_add_to_cart():
    with patch('app.services.cart_service.aioredis.from_url', return_value=fakeredis.aioredis.FakeRedis(decode_responses=True)):
        cart_service = CartService()
        user_id = 123
        product_id = 1
        await cart_service.clear_cart(user_id)
        result = await cart_service.add_item(user_id, product_id, quantity=2)
        assert result is True
        cart = await cart_service.get_cart(user_id)
        assert cart == {"1": 2}
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–æ–≤

- `test_add_to_cart`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É.
- `test_get_empty_cart`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã.
- `test_add_nonexistent_product`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞.